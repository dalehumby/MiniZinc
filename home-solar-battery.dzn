% ===== Rolling horizon from *midday today* for 36h =====
T = 36;
start_hod = 12;  % we're starting at 12:00 (noon) today

% ---- Forecasts from *now* (t=1) to now+36h ----
S = [1.8,1.68,1.44,1.05,0.66,0.36,0.15,0.06,0,0,0,0,0,0,0,0,0,0,0,0,0.07,0.21,0.42,0.56,0.7,0.91,1.12,1.61,1.96,2.1,1.96,1.68,1.225,0.77,0.42,0.175];
L = [0.95,1.05,1.15,1.35,1.55,1.85,2.15,1.95,1.6,1.3,1.1,1,0.9,0.95,0.95,1.05,1.15,1.35,1.65,1.65,1.45,1.25,1.05,0.95,0.95,1.05,1.15,1.35,1.55,1.85,2.15,1.95,1.6,1.3,1.1,1];
pb = [0.25,0.27,0.31,0.35,0.41,0.43,0.48,0.43,0.35,0.31,0.25,0.21,0.21,0.19,0.19,0.21,0.23,0.26,0.31,0.36,0.29,0.25,0.23,0.23,0.25,0.27,0.31,0.35,0.41,0.43,0.48,0.43,0.35,0.31,0.25,0.21];


% Low feed-in tariff (encourages self-consumption)
ps = [ pb[t] * 0.20 | t in 1..T ];

% ---- Battery & grid limits ----
C = 10.0;
Pmax = 10.0;
eta_c = 0.95;
eta_d = 0.95;

x0   = 5.0;        % measured SOC at *now* (kWh)
xmin = 1.0;        % keep a safety buffer
xmax = 10.0;

GridImportMax = 10.0;
GridExportMax = 10.0;

% ---- Costs / penalties ----
alpha            = 0.01;   % tiny battery wear proxy
beta_export      = 0.00;   % extra export penalty (0 if none)
lambda_switch    = 0.02;   % discourage fast flip-flops charge<->discharge

% Soft terminal SOC preference (keep small; it's just a nudge)
x_target_min     = 3.0;
x_target_max     = 7.0;
lambda_terminal  = 0.02;

% ---- Pool pump config ----
pump_kw = 1.2;                 % kW when running
pump_min_hours_per_day = 6;    % daily target
pump_start_hour = 8;           % can run 08:00 inclusive
pump_end_hour   = 20;          % .. to 20:00 exclusive

% --- Advice heuristics ---
cheap_threshold = 0.30;    % currency/kWh; marks “cheap” marginal cost
eps_export      = 0.10;    % kW export threshold to call it “surplus”
discharge_pen   = 0.02;    % small nudge to avoid discharge hours for advice

% Already ran *today* before this solve:
pump_hours_done_today = 3;

% Only penalize today’s shortfall (as you chose):
lambda_pump_shortage = 10.0;

